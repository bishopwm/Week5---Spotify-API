<html>
<head>
	<title>Spotify Artist Search</title>
		
		<style>
		img {
			width: 25%;
		}

		html {
			background-color: green;
		}
		</style>

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<script type="text/javascript" src=" https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

</head>
<body>
	<h1 class="complex-heading">
		Spotify Artist Search
	</h1>

	<form>
		<input type="text" name="q" placeholder="Artist Name">
		<button class="js-submit" type="submit" id="submit">SUBMIT</button>
	</form>

	<div class="mymodal modal fade" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Artists</h4>
      </div>
      <div class="modal-body">
        <p>
        	<ul class="artist-list"></ul>
        </p>
      </div>
      <div class="modal-body">
      		<ul class="album-list" data-id="album_visibility" style="visibility: hidden">Albums by this Artist</ul>
	  </div>
	  <div class="modal-body">
	  		<ul class="track-list"></ul>
  				<div class="head_p">
			           <h4 class="modal-title">Play Track</h4>
			           <audio class="player" autoplay controls="controls"></audio>
				</div>
	  </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


	<script>

	// $('.mymodal').hide();

	// 	$('.js-submit').on('click', function(event) {
	// 		event.preventDefault();
	// 		displayInfo();
	// });


	var displayInfo = function(infoReceived) {
		$('.artist-list').append("<img src="+infoReceived.artists.items[0].images[0].url+">");
		infoReceived.artists.items.forEach(function(singer) {
			$('.artist-list').append("<li>" + "<a href='#' data-id=" + singer.id + ">" + singer.name + "</a></li>");
		});
	}

	$('form').on('submit', function(event){
		event.preventDefault();
		$('.mymodal').modal();
		var searchArtist = $('form').serialize();
		var requestArtist = $.get('https://api.spotify.com/v1/search?type=artist&' + searchArtist);
		requestArtist.done(displayInfo);  
	});

	var displayAlbum = function(albums) {
		albums.items.forEach(function(album) {
		$('.album-list').append("<li>" + "<a href='#' class='album-link' data-id=" + album.id + ">" + album.name + "</a></li>");
		});
		
	}

	$('.artist-list').on('click', 'a', function(event) {
		event.preventDefault();
		var searchArtist = $('form').serialize();
		var artistID = $(event.currentTarget).attr('data-id');
		var requestID = $.get('https://api.spotify.com/v1/artists/' + artistID + '/albums');
		requestID.done(displayAlbum);
	});

	var displayTracks = function(tracks) {
		tracks.items.forEach(function(track) {
			$('.track-list').append("<li>" + "<a href='#' class='track-link' data-url=" + track.preview_url + ">" + track.name + "</a></li>");
		});
	}
	var playSong = function (response) {
		$('.player').empty()
		var song = response.items[0].preview_url;
		$('.player').attr('src', song);
		console.log('playyyy');
	}

	$('.album-list').on('click', 'a.album-link', function(event) {
		event.preventDefault();
		function makeVisible() {
			document.getElementById(".album_visibility").style.visibility="visible";
		}
		var searchArtist = $('form').serialize();
		var albumID = $(event.currentTarget).attr('data-id');
		var requestAlbumID = $.get('https://api.spotify.com/v1/albums/' + albumID + '/tracks');
		requestAlbumID.done(displayTracks);
	});

	$('.track-list').on('click', 'a.track-link', function(event) {
		$('.player').empty();
		var trackURL = $(event.currentTarget).attr('data-url');
		$('.player').prop('src', trackURL);

	});

	$('.close').on('click', function(event) {
		event.preventDefault();
		$('.my-modal').hide();
	});


	</script>
</body>
</html>